# ุณุณุชู ุชูุงุณ ุตูุช ุงูุงูฺฉ

## ๐ฏ ูุฏู

ุงุฑุณุงู ุชูุงุณ ุตูุช ุฎูุฏฺฉุงุฑ ุจู ฺฉุงุฑุจุฑุงู ุจุนุฏ ุงุฒ ฺฉ ุฏููู ุงุฒ ุซุจุช ูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุงูุงูฺฉ.

## ๐ ูฺฺฏโูุง

- โ **ุชูุงุณ ุตูุช ุฎูุฏฺฉุงุฑ**: ุงุฑุณุงู ุชูุงุณ ุจุนุฏ ุงุฒ 1 ุฏููู ุงุฒ ุซุจุช ูุงู
- โ **ูุฏุฑุช ุฎุทุง**: ูุฏุฑุช ฺฉุงูู ุฎุทุงูุง API ุงูุงูฺฉ
- โ **ูุงุจูุช ูุนุงู/ุบุฑูุนุงู**: ุงูฺฉุงู ุฎุงููุด/ุฑูุดู ฺฉุฑุฏู ุณุฑูุณ
- โ **ูุงฺฏโฺฏุฐุงุฑ ฺฉุงูู**: ุซุจุช ุชูุงู ุนููุงุช ู ุฎุทุงูุง
- โ **Non-blocking**: ุงุฌุฑุง ุฏุฑ background ุจุฏูู ุชุฃุซุฑ ุจุฑ ุนููฺฉุฑุฏ

## ๐ง ุชูุธูุงุช

### Configuration (config.yaml)
```yaml
avanak:
  token: "588E620576C8067DB8E40AC8032EF798ED0CA76E"
  message_id: 1000  # ฺฉุฏ ูุงู ุตูุช
  base_url: "https://portal.avanak.ir/rest/QuickSend"
  enabled: true
```

### ูพุงุฑุงูุชุฑูุง ุงูุงูฺฉ
- **Token**: ุชูฺฉู ุงุญุฑุงุฒ ููุช ุงูุงูฺฉ
- **MessageID**: ฺฉุฏ ูุงู ุตูุช (1000)
- **BaseURL**: ุขุฏุฑุณ API ุงูุงูฺฉ
- **Enabled**: ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ุณุฑูุณ

## ๐ ูุญูู ฺฉุงุฑฺฉุฑุฏ

### 1. ุซุจุช ูุงู ฺฉุงุฑุจุฑ
```
ฺฉุงุฑุจุฑ: [ุซุจุช ูุงู ฺฉุงูู]
ุฑุจุงุช: [ุงุฑุณุงู SMS + ูุฏู + ุงุทูุงุนุงุช ูพุดุชุจุงู]
```

### 2. ุชูุงุณ ุตูุช (ุจุนุฏ ุงุฒ 1 ุฏููู)
```
[1 ุฏููู ุจุนุฏ]
ุณุณุชู: [ุงุฑุณุงู ุชูุงุณ ุตูุช ุจู ุดูุงุฑู ฺฉุงุฑุจุฑ]
```

### 3. ูุฏุฑุช ุฎุทุง
```
ุงฺฏุฑ ุชูุงุณ ูููู ุจุงุดุฏ:
โ Voice call sent successfully to user 123456789 (09123456789)

ุงฺฏุฑ ุฎุทุง ุจุงุดุฏ:
โ Avanak error for 09123456789: ุนุฏู ููุฌูุฏ ฺฉุงู (code: -3)
```

## ๐ API ุงูุงูฺฉ

### ุฏุฑุฎูุงุณุช
```http
POST https://portal.avanak.ir/rest/QuickSend
Authorization: 588E620576C8067DB8E40AC8032EF798ED0CA76E
Content-Type: application/x-www-form-urlencoded

MessageID=39488781&Number=09123456789&Vote=false&ServerID=0
```

### ูพุงุณุฎ ูููู
```json
{
  "QuickSendID": 12345,
  "MessageID": 39488781,
  "MessageLength": 30,
  "CreditDecrease_InSeconds": 30,
  "CreditDecrease_InPulses": 1,
  "CreditDecrease_InPrice": 1000,
  "Status": "Success"
}
```

### ูพุงุณุฎ ุฎุทุง
```json
{
  "QuickSendID": -6,
  "MessageID": 0,
  "MessageLength": 0,
  "CreditDecrease_InSeconds": 0,
  "CreditDecrease_InPulses": 0,
  "CreditDecrease_InPrice": 0,
  "Status": "Failed"
}
```

## ๐ ฺฉุฏูุง ุฎุทุง

| ฺฉุฏ | ุชูุถุญุงุช |
|----|---------|
| -25 | ุซุจุช ุงุฑุณุงู ุณุฑุน ุบุฑูุนุงู ูุจุงุดุฏ |
| -2 | ุดูุงุฑู ุงุดุชุจุงู ูุจุงุดุฏ |
| -3 | ุนุฏู ููุฌูุฏ ฺฉุงู |
| -6 | ุฒูุงู ุงุฑุณุงู ุบุฑูุฌุงุฒ ูุจุงุดุฏ |
| -8 | ฺฉุฏ ูุงู ุตูุช ุงุดุชุจุงู ูุจุงุดุฏ |
| -71 | ูุฏุช ุถุจุท ุตุฏุง ุบุฑูุฌุงุฒ ูุจุงุดุฏ |
| -72 | ุนุฏู ูุฌูุฒ ุถุจุท ุตุฏุง |

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู

### ูุงูโูุง ุฌุฏุฏ
- `internal/services/avanak_service.go` - ุณุฑูุณ ุงูุงูฺฉ

### ูุงูโูุง ุขูพุฏุช ุดุฏู
- `config.yaml` - ุชูุธูุงุช ุงูุงูฺฉ
- `internal/config/config.go` - ุณุงุฎุชุงุฑ ฺฉุงููฺฏ
- `internal/services/delayed_message_service.go` - ุงุถุงูู ฺฉุฑุฏู ุชูุงุณ ุตูุช
- `internal/handlers/bot_handler.go` - ูุนุงูโุณุงุฒ ุชูุงุณ ุตูุช
- `main.go` - ุงุถุงูู ฺฉุฑุฏู ุณุฑูุณ ุงูุงูฺฉ

## ๐๏ธ ูพุงุฏูโุณุงุฒ

### AvanakService
```go
type AvanakService struct {
    config *config.AvanakConfig
}

// ุงุฑุณุงู ุชูุงุณ ุตูุช
func (s *AvanakService) SendVoiceCall(phoneNumber string) error

// ุจุฑุฑุณ ูุนุงู ุจูุฏู ุณุฑูุณ
func (s *AvanakService) IsEnabled() bool
```

### DelayedMessageService
```go
// ุจุฑูุงููโุฑุฒ ุชูุงุณ ุตูุช ุจุนุฏ ุงุฒ ุซุจุช ูุงู
func (s *DelayedMessageService) ScheduleVoiceCallAfterRegistration(userID int64, phoneNumber string)
```

## ๐ ุงููุช

### ูุญุฏูุฏุชโูุง
- ููุท ฺฉุงุฑุจุฑุงู ุซุจุชโูุงู ุดุฏู ุชูุงุณ ุฏุฑุงูุช ูโฺฉููุฏ
- ุชุฃุฎุฑ 1 ุฏูููโุง ุจุฑุง ุฌููฺฏุฑ ุงุฒ spam
- ูุฏุฑุช ุฎุทุงูุง API

### ูุฏุฑุช ุฎุทุง
- ุซุจุช ฺฉุงูู ุฎุทุงูุง ุฏุฑ ูุงฺฏ
- ุงุฏุงูู ฺฉุงุฑ ุณุณุชู ุฏุฑ ุตูุฑุช ุฎุทุง ุชูุงุณ
- ูพุงูโูุง ูุงุถุญ ุจุฑุง debugging

## ๐ ูุงูุชูุฑูฺฏ

### ูุงฺฏโูุง
- ุซุจุช ุงุฑุณุงู ูููู ุชูุงุณโูุง
- ุซุจุช ุฎุทุงูุง API ุงูุงูฺฉ
- ุขูุงุฑ ุชุนุฏุงุฏ ุชูุงุณโูุง ุงุฑุณุงู ุดุฏู

### Metrics
- ุชุนุฏุงุฏ ุชูุงุณโูุง ูููู
- ูุฑุฎ ุฎุทุง
- ุฒูุงู ูุชูุณุท ุงุฑุณุงู

## ๐จ UI/UX

### ุชุฌุฑุจู ฺฉุงุฑุจุฑ
- ุชูุงุณ ุตูุช ุจุฏูู ุชุฃุฎุฑ ุฏุฑ ุฑุจุงุช
- ุนุฏู ููุงุด ูพุงู ุงุถุงู
- ุชูุงุณ ููุท ุจุฑุง ฺฉุงุฑุจุฑุงู ุฌุฏุฏ

### ูุฏุฑุช
- ูุงุจูุช ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู
- ุชูุธู ฺฉุฏ ูุงู ุตูุช
- ูุฏุฑุช ุชูฺฉู ุงูุงูฺฉ

## ๐ฎ ุขูุฏูโูฺฏุฑ

### ุจูุจูุฏูุง ูพุดููุงุฏ
1. **ฺูุฏ ูุงู ุตูุช**: ูพุดุชุจุงู ุงุฒ ูุงูโูุง ูุฎุชูู
2. **ุฒูุงูโุจูุฏ**: ุชูุธู ุฒูุงูโูุง ูุฎุชูู
3. **Retry mechanism**: ุชูุงุด ูุฌุฏุฏ ุจุฑุง ุฎุทุงูุง
4. **Analytics**: ุขูุงุฑฺฏุฑ ุงุฒ ุชูุงุณโูุง
5. **A/B Testing**: ุชุณุช ูุงูโูุง ูุฎุชูู

### ูฺฺฏโูุง ูู
1. **Queue system**: ุณุณุชู ุตู ุจุฑุง ุชูุงุณโูุง
2. **Rate limiting**: ูุญุฏูุฏุช ุชุนุฏุงุฏ ุชูุงุณ
3. **Caching**: ฺฉุด ฺฉุฑุฏู ุชูุธูุงุช
4. **Monitoring**: ูุงูุชูุฑูฺฏ ูพุดุฑูุชู

## ๐ง ุนุจโุงุจ

### ูุดฺฉู ฺฉุฏ ุฎุทุง -6 (ุฒูุงู ุงุฑุณุงู ุบุฑูุฌุงุฒ)
```
Avanak error for 09301052378: ุฒูุงู ุงุฑุณุงู ุบุฑูุฌุงุฒ ูุจุงุดุฏ (code: -6)
```

**ุนูู ุงุญุชูุงู:**
1. **ุฒูุงูโุจูุฏ ูุญุฏูุฏ**: ุงูุงูฺฉ ููฺฉู ุงุณุช ุฒูุงูโูุง ุฎุงุต ุฑุง ุจุฑุง ุงุฑุณุงู ูุฌุงุฒ ฺฉูุฏ
2. **ููุทูู ุฒูุงู**: ููฺฉู ุงุณุช ุจุง ููุทูู ุฒูุงู ุณุฑูุฑ ูุดฺฉู ุจุงุดุฏ
3. **ูุญุฏูุฏุช ุฒูุงู**: ููฺฉู ุงุณุช ุฏุฑ ุณุงุนุงุช ุฎุงุต ุงุฑุณุงู ูุฌุงุฒ ูุจุงุดุฏ

**ุฑุงูโุญูโูุง:**
1. **ุจุฑุฑุณ ุฒูุงู ุณุฑูุฑ**: ูุทูุฆู ุดูุฏ ุณุฑูุฑ ุฏุฑ ููุทูู ุฒูุงู ุฏุฑุณุช ุงุณุช
2. **ุชูุงุณ ุจุง ูพุดุชุจุงู ุงูุงูฺฉ**: ุจุฑุง ุจุฑุฑุณ ูุญุฏูุฏุชโูุง ุฒูุงู
3. **ุชุณุช ุฏุฑ ุฒูุงูโูุง ูุฎุชูู**: ุงูุชุญุงู ฺฉุฑุฏู ุฏุฑ ุณุงุนุงุช ูุฎุชูู ุฑูุฒ

### ุชุณุช ุงุชุตุงู
```bash
# ุงุฌุฑุง ุชุณุช ูุณุชูู
go run test_avanak.go
```

**โ๏ธ ุชูุฌู: ุชุณุช ุงุชุตุงู ุญุงูุง ุชูุงุณ ูุงูุน ุงุฑุณุงู ูโฺฉูุฏ!**

### ุชุณุช ูุงูุน ุฏุฑ startup
```bash
# ูุฑ ุจุงุฑ ุฑโุงุณุชุงุฑุช ุณุณุชูุ ุชูุงุณ ุชุณุช ุงุฑุณุงู ูโุดูุฏ
go run main.go
```

**ูุงฺฏโูุง ุชุณุช:**
```
๐ ุดุฑูุน ุชุณุช ุงุชุตุงู ุงูุงูฺฉ - ุงุฑุณุงู ุชูุงุณ ูุงูุน...
๐ ุงุฑุณุงู ุชูุงุณ ุชุณุช ุจู ุดูุงุฑู 09155520952...
โ ุชุณุช ุงุชุตุงู ุงูุงูฺฉ ูููู - ุชูุงุณ ุจู 09155520952 ุงุฑุณุงู ุดุฏ
โ ุชุณุช ุงุชุตุงู ุงูุงูฺฉ ูููู - ุชูุงุณ ุชุณุช ุงุฑุณุงู ุดุฏ
```

### ูุงฺฏโูุง ููุฏ
```
2025/10/12 21:53:14 Testing Avanak connection...
2025/10/12 21:53:14 Avanak test response: {"QuickSendID":-6,"MessageID":0,"MessageLength":0,"CreditDecrease_InSeconds":0,"CreditDecrease_InPulses":0,"CreditDecrease_InPrice":0,"Status":"Failed"}
2025/10/12 21:53:14 Avanak test failed: ุฒูุงู ุงุฑุณุงู ุบุฑูุฌุงุฒ ูุจุงุดุฏ (code: -6)
```

## โ ุชุณุช

### ุณูุงุฑููุง ุชุณุช
1. **ฺฉุงุฑุจุฑ ุฌุฏุฏ**: ุจุงุฏ ุชูุงุณ ุตูุช ุฏุฑุงูุช ฺฉูุฏ
2. **ฺฉุงุฑุจุฑ ูุฏู**: ูุจุงุฏ ุชูุงุณ ุฏุฑุงูุช ฺฉูุฏ
3. **ุฎุทุง API**: ุจุงุฏ ุฎุทุง ุซุจุช ุดูุฏ
4. **ุณุฑูุณ ุบุฑูุนุงู**: ูุจุงุฏ ุชูุงุณ ุงุฑุณุงู ุดูุฏ

### ุชุณุช ุฏุณุช
```bash
# 1. ุฑุจุงุช ุฑุง ุงุฌุฑุง ฺฉูุฏ
go run main.go

# 2. ฺฉุงุฑุจุฑ ุฌุฏุฏ ุซุจุช ูุงู ฺฉูุฏ
# 3. 1 ุฏููู ุตุจุฑ ฺฉูุฏ
# 4. ุชูุงุณ ุตูุช ุจุงุฏ ุงุฑุณุงู ุดูุฏ
```

### ุชุณุช ุงุชุตุงู API
```bash
# ุชุณุช ูุณุชูู API ุงูุงูฺฉ
go run test_avanak.go
```

## ๐ ูฺฉุงุช ููู

1. **ุชูฺฉู ุงูุงูฺฉ**: ุจุงุฏ ูุนุชุจุฑ ุจุงุดุฏ
2. **ฺฉุฏ ูุงู ุตูุช**: ุจุงุฏ ุฏุฑ ุงูุงูฺฉ ุชุนุฑู ุดุฏู ุจุงุดุฏ
3. **ููุฌูุฏ**: ุจุงุฏ ููุฌูุฏ ฺฉุงู ุฏุงุดุชู ุจุงุดุฏ
4. **ุชุณุช ฺฉุงูู**: ูุจู ุงุฒ production ุชุณุช ฺฉูุฏ
5. **โ๏ธ ุชุณุช ูุงูุน**: ูุฑ ุฑโุงุณุชุงุฑุช ุชูุงุณ ุชุณุช ุงุฑุณุงู ูโุดูุฏ

## ๐ง ูุฏุฑุช ุชุณุช

### ุบุฑูุนุงู ฺฉุฑุฏู ุชุณุช
ุงฺฏุฑ ููโุฎูุงูุฏ ูุฑ ุจุงุฑ ุชูุงุณ ุชุณุช ุงุฑุณุงู ุดูุฏ:

```yaml
# config.yaml
avanak:
  enabled: false  # ุบุฑูุนุงู ฺฉุฑุฏู ฺฉู ุณุฑูุณ
```

### ุชุบุฑ ุดูุงุฑู ุชุณุช
```go
// internal/services/avanak_service.go
testNumber := "09155520952"  // ุดูุงุฑู ุดูุง
```

### ุญุฐู ุชุณุช ุงุฒ startup
```go
// main.go - ฺฉุงููุช ฺฉุฑุฏู ุงู ุจุฎุด
// Test Avanak connection with real voice call
// if avanakService.IsEnabled() {
//     log.Printf("๐ ุดุฑูุน ุชุณุช ุงุชุตุงู ุงูุงูฺฉ - ุงุฑุณุงู ุชูุงุณ ูุงูุน...")
//     err = avanakService.TestConnection()
//     ...
// }
```

## ๐ ูุชุฌู

ุณุณุชู ุชูุงุณ ุตูุช ุญุงูุง:
- โ ุชูุงุณ ุตูุช ุฎูุฏฺฉุงุฑ ุงุฑุณุงู ูโฺฉูุฏ
- โ ูุฏุฑุช ุฎุทุง ุฏุงุฑุฏ
- โ ูุงุจู ุชูุธู ุงุณุช
- โ ุนููฺฉุฑุฏ ุจููู ุฏุงุฑุฏ
- โ ูุงุจู ูุงูุชูุฑูฺฏ ุงุณุช
