# ุณุณุชู ูพุงูโูุง ุชุฃุฎุฑ (Delayed Message System)

## ๐ข ูฺฺฏโูุง ุณุณุชู

ุณุณุชู ูพุงูโูุง ุชุฃุฎุฑ ุงูฺฉุงู ุงุฑุณุงู ูพุงูโูุง ุฎูุฏฺฉุงุฑ ุจุง ุชุฃุฎุฑ ุฒูุงู ุฑุง ูุฑุงูู ูโฺฉูุฏ. ุงู ุณุณุชู ุจุฑุง ุงุฑุณุงู ูพุงูโูุง ูพฺฏุฑ ู ุงุฏุขูุฑ ุจู ฺฉุงุฑุจุฑุงู ุงุณุชูุงุฏู ูโุดูุฏ.

### โ ูฺฺฏโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

#### 1. **ูพุงู ูพฺฏุฑ ููฺฉ ฺฏุฑูู**
- **ุฒูุงู ุชุฃุฎุฑ**: 1 ุฏููู ุจุนุฏ ุงุฒ ุงุฑุณุงู ููฺฉ ฺฏุฑูู
- **ูพุงู**: "ฺููููุดููุฏ ฺฏูุงุฏุงุชูุฑ ุฏฺฉูู ุดุดู ุง ุฑู ฺฉูฺฉ ฺฉุฑุฏ ุจุฑุง ูุฑูุฏ ุจู ุฑุจุงุชโ๏ธ"
- **ูฺฉุงู ุงุฑุณุงู**: ุจุนุฏ ุงุฒ ุงุฑุณุงู ุงุทูุงุนุงุช ูพุดุชุจุงู ู ููฺฉ ฺฏุฑูู

#### 2. **ูพุงูโูุง ุณูุงุฑุด**
- ุงูฺฉุงู ุงุฑุณุงู ูพุงูโูุง ุณูุงุฑุด ุจุง ุชุฃุฎุฑ ุฏูุฎูุงู
- ูพุดุชุจุงู ุงุฒ ูพุงูโูุง ุดุฎุตโุณุงุฒ ุดุฏู
- ูุฏุฑุช ุฎุทุง ู retry mechanism

#### 3. **ูพุงูโูุง ุฎูุดโุขูุฏฺฏู**
- ูพุงูโูุง ุฎูุดโุขูุฏฺฏู ุดุฎุตโุณุงุฒ ุดุฏู
- ุงุณุชูุงุฏู ุงุฒ ูุงู ฺฉุงุฑุจุฑ ุฏุฑ ูพุงู
- ุชุฃุฎุฑ ูุงุจู ุชูุธู

## ๐๏ธ ูุนูุงุฑ ุณุณุชู

### ุณุฑูุณ DelayedMessageService

```go
type DelayedMessageService struct {
    db  *database.Database
    bot *tgbotapi.BotAPI
}
```

#### ูุชุฏูุง ุงุตู:

##### `ScheduleDelayedMessage(userID, message, delay)`
- ุงุฑุณุงู ูพุงู ุจุง ุชุฃุฎุฑ ูุดุฎุต
- ุงุณุชูุงุฏู ุงุฒ goroutines ุจุฑุง non-blocking execution
- ูุฏุฑุช ุฎุทุง ู logging

##### `ScheduleGroupLinkFollowUp(userID)`
- ุงุฑุณุงู ูพุงู ูพฺฏุฑ ููฺฉ ฺฏุฑูู
- ุชุฃุฎุฑ ุซุงุจุช 1 ุฏููู
- ูพุงู ูพุดโุชุนุฑู ุดุฏู

##### `ScheduleWelcomeFollowUp(userID, userName)`
- ุงุฑุณุงู ูพุงู ุฎูุดโุขูุฏฺฏู ุดุฎุตโุณุงุฒ ุดุฏู
- ุงุณุชูุงุฏู ุงุฒ ูุงู ฺฉุงุฑุจุฑ
- ุชุฃุฎุฑ 1 ุฏููู

##### `ScheduleCustomDelayedMessage(userID, message, delayMinutes)`
- ุงุฑุณุงู ูพุงู ุณูุงุฑุด ุจุง ุชุฃุฎุฑ ุฏูุฎูุงู
- ุชุฃุฎุฑ ุจุฑ ุญุณุจ ุฏููู
- ุงูุนุทุงูโูพุฐุฑ ฺฉุงูู

## ๐ ูุญูู ุงุณุชูุงุฏู

### 1. ูพุงู ูพฺฏุฑ ููฺฉ ฺฏุฑูู (ุฎูุฏฺฉุงุฑ)
ุงู ูพุงู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุนุฏ ุงุฒ ุงุฑุณุงู ููฺฉ ฺฏุฑูู ุงุฑุณุงู ูโุดูุฏ:

```go
// ุฏุฑ bot_handler.go
h.delayedMessageService.ScheduleGroupLinkFollowUp(telegramID)
```

### 2. ูพุงูโูุง ุณูุงุฑุด
ุจุฑุง ุงุฑุณุงู ูพุงูโูุง ุณูุงุฑุด:

```go
// ูพุงู ุจุง ุชุฃุฎุฑ 5 ุฏููู
delayedMessageService.ScheduleCustomDelayedMessage(
    userID, 
    "ูพุงู ุณูุงุฑุด ุดูุง", 
    5
)

// ูพุงู ุฎูุดโุขูุฏฺฏู
delayedMessageService.ScheduleWelcomeFollowUp(
    userID, 
    "ูุงู ฺฉุงุฑุจุฑ"
)
```

## ๐ ูฺฉุงูโูุง ุงุฑุณุงู ูพุงู ูพฺฏุฑ

### 1. **ุซุจุช ูุงู ุงููู ฺฉุงุฑุจุฑ**
- ุจุนุฏ ุงุฒ ุงุฑุณุงู ูุฏู ุขููุฒุด
- ุจุนุฏ ุงุฒ ุงุฑุณุงู ุงุทูุงุนุงุช ูพุดุชุจุงู
- ุจุนุฏ ุงุฒ ุงุฑุณุงู ููฺฉ ฺฏุฑูู

### 2. **ุจุงุฒฺฏุดุช ฺฉุงุฑุจุฑุงู**
- ููุช ฺฉุงุฑุจุฑ ูุฌุฏุฏุงู `/start` ูโุฒูุฏ
- ุจุนุฏ ุงุฒ ุงุฑุณุงู ูุฌุฏุฏ ูุฏู ู ุงุทูุงุนุงุช
- ุจุนุฏ ุงุฒ ุงุฑุณุงู ูุฌุฏุฏ ููฺฉ ฺฏุฑูู

### 3. **ูุฑ ุฏู ุญุงูุช**
- ูพุงู ูพฺฏุฑ ุฏุฑ ูุฑ ุฏู ุญุงูุช ุงุฑุณุงู ูโุดูุฏ
- ุชุฃุฎุฑ ฺฉุณุงู (1 ุฏููู)
- ูพุงู ฺฉุณุงู

## โ๏ธ ุชูุธูุงุช ู ูพฺฉุฑุจูุฏ

### ุชุฃุฎุฑ ุฒูุงู
- **ูพุดโูุฑุถ**: 1 ุฏููู
- **ูุงุจู ุชูุธู**: ุจูู
- **ูุงุญุฏ**: ุฏููู

### ูุฏุฑุช ุฎุทุง
- **Logging**: ุซุจุช ฺฉุงูู ุฎุทุงูุง
- **Retry**: ุนุฏู ูพุงุฏูโุณุงุฒ (ูโุชูุงู ุงุถุงูู ฺฉุฑุฏ)
- **Fallback**: ุงุฏุงูู ฺฉุงุฑ ุฏุฑ ุตูุฑุช ุฎุทุง

### Performance
- **Non-blocking**: ุงุณุชูุงุฏู ุงุฒ goroutines
- **Memory efficient**: ุนุฏู ุฐุฎุฑูโุณุงุฒ state
- **Scalable**: ูุงุจูุช ุงุฑุณุงู ุจู ูุฒุงุฑุงู ฺฉุงุฑุจุฑ

## ๐ง ุชูุณุนู ู ุณูุงุฑุดโุณุงุฒ

### ุงุถุงูู ฺฉุฑุฏู ูพุงูโูุง ุฌุฏุฏ
1. ูุชุฏ ุฌุฏุฏ ุฏุฑ `DelayedMessageService` ุงุถุงูู ฺฉูุฏ
2. ูพุงู ู ุชุฃุฎุฑ ููุฑุฏ ูุธุฑ ุฑุง ุชุนุฑู ฺฉูุฏ
3. ุฏุฑ ูฺฉุงู ููุงุณุจ ุฏุฑ `BotHandler` ูุฑุงุฎูุงู ฺฉูุฏ

### ุชุบุฑ ุชุฃุฎุฑ ุฒูุงู
```go
// ุชุบุฑ ุชุฃุฎุฑ ุงุฒ 1 ุฏููู ุจู 2 ุฏููู
s.ScheduleDelayedMessage(userID, message, 2*time.Minute)
```

### ุงุถุงูู ฺฉุฑุฏู ูพุงูโูุง ุดุฑุท
```go
// ุงุฑุณุงู ูพุงู ุจุฑ ุงุณุงุณ ุดุฑุงุท ุฎุงุต
if someCondition {
    delayedMessageService.ScheduleCustomDelayedMessage(userID, message, 1)
}
```

## ๐ ูุซุงูโูุง ุงุณุชูุงุฏู

### ูุซุงู 1: ูพุงู ูพฺฏุฑ ุณุงุฏู
```
ฺฉุงุฑุจุฑ: /start
ุฑุจุงุช: [ุงุฑุณุงู ูุฏู + ุงุทูุงุนุงุช ูพุดุชุจุงู + ููฺฉ ฺฏุฑูู]
[1 ุฏููู ุจุนุฏ]
ุฑุจุงุช: ฺููููุดููุฏ ฺฏูุงุฏุงุชูุฑ ุฏฺฉูู ุดุดู ุง ุฑู ฺฉูฺฉ ฺฉุฑุฏ ุจุฑุง ูุฑูุฏ ุจู ุฑุจุงุชโ๏ธ
```

### ูุซุงู 2: ูพุงู ุณูุงุฑุด
```go
// ุงุฑุณุงู ูพุงู ุงุฏุขูุฑ ุจุนุฏ ุงุฒ 30 ุฏููู
delayedMessageService.ScheduleCustomDelayedMessage(
    userID,
    "ุงุฏุขูุฑ: ูุทูุงู ุฏุฑ ฺุงูุด ุดุฑฺฉุช ฺฉูุฏ!",
    30
)
```

### ูุซุงู 3: ูพุงู ุฎูุดโุขูุฏฺฏู
```go
// ุงุฑุณุงู ูพุงู ุฎูุดโุขูุฏฺฏู ุดุฎุต
delayedMessageService.ScheduleWelcomeFollowUp(
    userID,
    "ุงุญูุฏ ุงุญูุฏ"
)
```

## ๐ก๏ธ ุงููุช ู ูุญุฏูุฏุชโูุง

### ูุญุฏูุฏุชโูุง ูุนู
- **ุชุฃุฎุฑ ุญุฏุงฺฉุซุฑ**: ูุงูุญุฏูุฏ (ุชูุตู: ฺฉูุชุฑ ุงุฒ 24 ุณุงุนุช)
- **ุชุนุฏุงุฏ ูพุงูโูุง ููุฒูุงู**: ูุงูุญุฏูุฏ
- **Memory usage**: ฺฉู (ุจุฏูู ุฐุฎุฑูโุณุงุฒ state)

### ุจูุจูุฏูุง ูพุดููุงุฏ
- **Rate limiting**: ูุญุฏูุฏุช ุชุนุฏุงุฏ ูพุงูโูุง ุชุฃุฎุฑ
- **Queue system**: ุณุณุชู ุตู ุจุฑุง ูุฏุฑุช ุจูุชุฑ
- **Persistence**: ุฐุฎุฑูโุณุงุฒ ูพุงูโูุง ุชุฃุฎุฑ ุฏุฑ ุฏุชุงุจุณ

## ๐ ูุงูุชูุฑูฺฏ

### Logs
- ุซุจุช ุงุฑุณุงู ูููู ูพุงูโูุง
- ุซุจุช ุฎุทุงูุง ุงุฑุณุงู
- ุขูุงุฑ ุชุนุฏุงุฏ ูพุงูโูุง ุงุฑุณุงู ุดุฏู

### Metrics
- ุชุนุฏุงุฏ ูพุงูโูุง ุชุฃุฎุฑ ูุนุงู
- ูุฑุฎ ููููุช ุงุฑุณุงู
- ุฒูุงู ูุชูุณุท ุชุฃุฎุฑ

## ๐ฎ ุขูุฏูโูฺฏุฑ

### ูฺฺฏโูุง ูพุดููุงุฏ
1. **ูพุงูโูุง ุชฺฉุฑุงุฑ**: ุงุฑุณุงู ูพุงู ุฏุฑ ุจุงุฒูโูุง ุฒูุงู ูุดุฎุต
2. **ูพุงูโูุง ุดุฑุท**: ุงุฑุณุงู ุจุฑ ุงุณุงุณ ุดุฑุงุท ุฎุงุต
3. **Template system**: ุณุณุชู ูุงูุจ ุจุฑุง ูพุงูโูุง
4. **Analytics**: ุขูุงุฑฺฏุฑ ุงุฒ ุชุฃุซุฑ ูพุงูโูุง ุชุฃุฎุฑ
5. **A/B Testing**: ุชุณุช ูพุงูโูุง ูุฎุชูู

### ุจูุจูุฏูุง ูู
1. **Database persistence**: ุฐุฎุฑูโุณุงุฒ ุฏุฑ ุฏุชุงุจุณ
2. **Job queue**: ุณุณุชู ุตู ุจุฑุง ูพุงูโูุง
3. **Retry mechanism**: ุชูุงุด ูุฌุฏุฏ ุจุฑุง ุงุฑุณุงู ูุงูููู
4. **Scheduling**: ุฒูุงูโุจูุฏ ูพฺุฏูโุชุฑ
5. **Monitoring**: ูุงูุชูุฑูฺฏ ูพุดุฑูุชูโุชุฑ
