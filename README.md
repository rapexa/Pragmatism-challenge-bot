# ربات تلگرام ثبت نام کاربران

این پروژه یک ربات تلگرام است که به صورت خودکار فرآیند ثبت نام کاربران را مدیریت می‌کند و ویدیوهای آموزشی همراه با اطلاعات پشتیبانی ارسال می‌کند.

## ویژگی‌ها

- ✅ ثبت نام کاربران با دریافت نام، نام خانوادگی، شماره تماس و شغل
- ✅ اعتبارسنجی شماره‌های موبایل ایرانی
- ✅ ارسال پیامک تأیید ثبت نام
- ✅ ذخیره اطلاعات در دیتابیس MySQL
- ✅ ارسال ویدیو آموزشی پس از ثبت نام
- ✅ تخصیص پشتیبان ثابت به هر کاربر
- ✅ آپلود و مدیریت عکس پشتیبان‌ها
- ✅ ارسال اطلاعات پشتیبان و لینک گروه
- ✅ پنل ادمین کامل با قابلیت‌های مدیریتی
- ✅ معماری تمیز و جداسازی لایه‌ها
- ✅ لاگ‌های انگلیسی برای توسعه‌دهندگان و پیام‌های فارسی برای کاربران

## تکنولوژی‌های استفاده شده

- **Go (Golang)**: زبان برنامه‌نویسی اصلی
- **Viper**: مدیریت کانفیگ
- **GORM**: ORM برای کار با دیتابیس
- **MySQL**: دیتابیس
- **Telegram Bot API**: ارتباط با تلگرام
- **IPPanel SMS API**: ارسال پیامک
- **HTTP File Server**: سرو فایل‌های آپلود شده
- **Docker**: کانتینرسازی

## ساختار پروژه

```
telegram-bot/
├── main.go                     # فایل اصلی برنامه
├── config.yaml                 # فایل کانفیگ
├── go.mod                      # وابستگی‌های Go
├── internal/
│   ├── config/                 # مدیریت کانفیگ
│   │   └── config.go
│   ├── database/               # اتصال به دیتابیس
│   │   └── database.go
│   ├── models/                 # مدل‌های دیتا
│   │   ├── user.go
│   │   └── support.go
│   ├── services/               # منطق کسب و کار
│   │   ├── user_service.go
│   │   ├── support_service.go
│   │   └── support_admin_service.go
│   └── handlers/               # کنترلرهای ربات
│       └── bot_handler.go
├── Dockerfile                  # کانفیگ Docker
├── docker-compose.yml          # Docker Compose
└── README.md                   # مستندات
```

## راه‌اندازی

### پیش‌نیازها

- Go 1.21 یا بالاتر
- MySQL 8.0 یا بالاتر
- Docker (اختیاری)

### راه‌اندازی محلی

1. **کلون کردن پروژه:**
   ```bash
   git clone <repository-url>
   cd telegram-bot
   ```

2. **نصب وابستگی‌ها:**
   ```bash
   go mod tidy
   ```

3. **تنظیم کانفیگ:**
   فایل `config.yaml` را ویرایش کنید:
   ```yaml
   telegram:
     token: "YOUR_BOT_TOKEN"
     channel_id: -1002962445949  # ID کانال منبع ویدیو
     group_link: "https://t.me/rapexa_gap"  # لینک گروه

   database:
     host: "localhost"
     port: 3306
     user: "root"
     password: "your_password"
     name: "telegram_bot"
   ```

4. **ایجاد دیتابیس:**
   ```sql
   CREATE DATABASE telegram_bot CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

5. **اجرای برنامه:**
   ```bash
   go run main.go
   ```

### راه‌اندازی با Docker

1. **تنظیم کانفیگ در docker-compose.yml**

2. **اجرای کانتینرها:**
   ```bash
   docker-compose up -d
   ```

## نحوه استفاده

1. کاربر دستور `/start` را ارسال می‌کند
2. ربات نام و نام خانوادگی را درخواست می‌کند
3. سپس شماره تماس را درخواست می‌کند
4. در نهایت شغل کاربر را می‌پرسد
5. پس از تکمیل ثبت نام، ویدیو با کپشن "ثبت نام شما با موفقیت انجام شد" ارسال می‌شود
6. یک پشتیبان به صورت تصادفی و ثابت به کاربر تخصیص داده می‌شود
7. اطلاعات پشتیبان و عکس او با کپشن کامل ارسال می‌شود
8. اگر کاربر مجدداً `/start` بزند، همان پشتیبان قبلی نمایش داده می‌شود

## مدیریت پشتیبان‌ها

پشتیبان‌ها در دیتابیس ذخیره می‌شوند و شامل اطلاعات زیر هستند:
- نام پشتیبان
- نام کاربری تلگرام (@username)
- عکس پشتیبان
- وضعیت فعال/غیرفعال

### قابلیت‌های مدیریت پشتیبان در پنل ادمین:
- ➕ **افزودن پشتیبان جدید**
- 📝 **ویرایش کامل اطلاعات**:
  - ویرایش نام
  - ویرایش یوزرنیم
  - ویرایش عکس (آپلود مستقیم یا URL)
  - تغییر وضعیت فعال/غیرفعال
- 🗑 **حذف پشتیبان**

### قابلیت‌های آپلود عکس:
- 📤 **آپلود مستقیم**: ارسال عکس در تلگرام
- 🔗 **لینک خارجی**: وارد کردن URL عکس
- 💾 **ذخیره محلی**: عکس‌ها در سرور ذخیره می‌شوند
- 🌐 **دسترسی عمومی**: URL عمومی برای هر عکس

پشتیبان‌های تستی که به صورت خودکار اضافه می‌شوند:
- خانم فاطمه تقی زاده - @rapexam
- خانم بهار قربانی - @rapexam  
- خانم راضیه مزینانی - @rapexam

## نحوه کار ربات با پست‌های کانال

ربات به جای استفاده از File ID، پست مشخص شده را از کانال **کپی** می‌کند (بدون نشان دادن منبع):

### تنظیمات فعلی:
- **کانال منبع**: @uploadrobotfile (upload files)
- **ID کانال**: -1002962445949
- **شماره پست**: 2
- **لینک پست**: https://t.me/uploadrobotfile/2
- **گروه**: https://t.me/rapexa_gap

### مزایای کپی کردن پست:
- ✅ پست اصلی با تمام محتویات (caption، فرمت، و غیره) ارسال می‌شود
- ✅ منبع کانال نشان داده نمی‌شود (بر خلاف Forward)
- ✅ نیازی به File ID نیست
- ✅ اگر پست در کانال تغییر کند، تغییرات به صورت خودکار اعمال می‌شود
- ✅ حجم کد کمتر و پیاده‌سازی ساده‌تر

## مشارکت

برای مشارکت در این پروژه:

1. Fork کنید
2. برنچ جدید بسازید (`git checkout -b feature/amazing-feature`)
3. تغییرات را commit کنید (`git commit -m 'Add amazing feature'`)
4. Push کنید (`git push origin feature/amazing-feature`)
5. Pull Request ایجاد کنید

## لایسنس

این پروژه تحت لایسنس MIT منتشر شده است.
